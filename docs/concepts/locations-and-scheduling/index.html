<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.104.1"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Placement, Locations and Scheduling | kcp – a Kubernetes-like multi-tenant control plane</title><meta name=description content="KCP implements *Compute as a Service* via a concept of Transparent Multi Cluster (TMC).
"><meta property="og:title" content="Placement, Locations and Scheduling"><meta property="og:description" content="KCP implements *Compute as a Service* via a concept of Transparent Multi Cluster (TMC).
"><meta property="og:type" content="article"><meta property="og:url" content="http://kcp-dev.github.io/docs/concepts/locations-and-scheduling/"><meta property="article:section" content="docs"><meta property="og:site_name" content="kcp – a Kubernetes-like multi-tenant control plane"><meta itemprop=name content="Placement, Locations and Scheduling"><meta itemprop=description content="KCP implements *Compute as a Service* via a concept of Transparent Multi Cluster (TMC).
"><meta itemprop=wordCount content="1203"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Placement, Locations and Scheduling"><meta name=twitter:description content="KCP implements *Compute as a Service* via a concept of Transparent Multi Cluster (TMC).
"><link rel=preload href=/scss/main.min.c65bd9d7eb2baaad4d2c30a0905cadbf15f5bd43173d18c70d61a6eee706a020.css as=style><link href=/scss/main.min.c65bd9d7eb2baaad4d2c30a0905cadbf15f5bd43173d18c70d61a6eee706a020.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-sm-row td-navbar"><a class="navbar-brand mr-2" style=display:flex;justify-content:center href=/><img class=navbar-logo src=/logo.png width=38px alt=logo></a>
<a class=navbar-brand style=display:flex;justify-content:center href=/><span class="font-weight-bold d-none d-sm-inline d-lg-none" style=font-size:.875rem>kcp</span>
<span class="font-weight-bold d-none d-lg-inline">kcp</span></a><div class="td-navbar-nav-scroll ml-sm-auto mt-0" id=main_navbar><ul class="navbar-nav mt-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/kcp-dev/kcp/blob/main/CONTRIBUTING.md target=_blank><span>Contribute</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/kcp-dev/kcp/ target=_blank><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ title="Welcome to kcp Documentation" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-started-li><a href=/docs/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgetting-started><span>Getting Started</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsconcepts-li><a href=/docs/concepts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsconcepts><span>kcp Concepts</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsauthorization-li><a href=/docs/concepts/authorization/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsauthorization><span>Authorization</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptscache-server-li><a href=/docs/concepts/cache-server/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptscache-server><span>Cache Server</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptscluster-mapper-li><a href=/docs/concepts/cluster-mapper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptscluster-mapper><span>Cluster Mapper</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsconceptslocations-and-scheduling-li><a href=/docs/concepts/locations-and-scheduling/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsconceptslocations-and-scheduling><span class=td-sidebar-nav-active-item>Placement, Locations and Scheduling</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptssyncer-li><a href=/docs/concepts/syncer/ title="Registering Kubernetes Clusters using syncer" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptssyncer><span>Syncer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsquickstart-tenancy-and-apis-li><a href=/docs/concepts/quickstart-tenancy-and-apis/ title="Quickstart: Tenancy and APIs" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsquickstart-tenancy-and-apis><span>Tenancy and APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsconcepts-li><a href=/docs/concepts/concepts/ title="Terminology for control plane" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsconcepts><span>Terminology</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsvirtual-workspaces-li><a href=/docs/concepts/virtual-workspaces/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsvirtual-workspaces><span>Virtual Workspaces</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsworkspaces-li><a href=/docs/concepts/workspaces/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsworkspaces><span>Workspaces</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsconceptsdevelopers-li><a href=/docs/concepts/developers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsconceptsdevelopers><span>Developers</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsdeveloperscontrollers-li><a href=/docs/concepts/developers/controllers/ title="Writing kcp-aware controllers" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsdeveloperscontrollers><span>kcp-aware controllers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsdeveloperslibrary-usage-li><a href=/docs/concepts/developers/library-usage/ title="Using `kcp` as a library" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsdeveloperslibrary-usage><span>Library Usage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsdevelopersreleasing-li><a href=/docs/concepts/developers/releasing/ title="Publishing a new kcp release" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsdevelopersreleasing><span>Publishing</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsconceptsinvestigations-li><a href=/docs/concepts/investigations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsconceptsinvestigations><span>Investigations</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsinvestigationslogical-clusters-li><a href=/docs/concepts/investigations/logical-clusters/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsinvestigationslogical-clusters><span>Logical clusters</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsinvestigationsminimal-api-server-li><a href=/docs/concepts/investigations/minimal-api-server/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsinvestigationsminimal-api-server><span>Minimal API Server</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsinvestigationsself-service-policy-li><a href=/docs/concepts/investigations/self-service-policy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsinvestigationsself-service-policy><span>Self-service policy</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptsinvestigationstransparent-multi-cluster-li><a href=/docs/concepts/investigations/transparent-multi-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptsinvestigationstransparent-multi-cluster><span>Transparent multi-cluster</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsconceptskubectl-kcp-plugin-li><a href=/docs/concepts/kubectl-kcp-plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconceptskubectl-kcp-plugin><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscli-reference-li><a href=/docs/cli-reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscli-reference><span>CLI Reference</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp-li><a href=/docs/cli-reference/kcp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp><span>kcp</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_crd-li><a href=/docs/cli-reference/kcp_crd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_crd><span>kcp crd</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_crd_snapshot-li><a href=/docs/cli-reference/kcp_crd_snapshot/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_crd_snapshot><span>kcp crd snapshot</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workload-li><a href=/docs/cli-reference/kcp_workload/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workload><span>kcp workload</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workload_cordon-li><a href=/docs/cli-reference/kcp_workload_cordon/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workload_cordon><span>kcp workload cordon</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workload_drain-li><a href=/docs/cli-reference/kcp_workload_drain/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workload_drain><span>kcp workload drain</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workload_sync-li><a href=/docs/cli-reference/kcp_workload_sync/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workload_sync><span>kcp workload sync</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workload_uncordon-li><a href=/docs/cli-reference/kcp_workload_uncordon/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workload_uncordon><span>kcp workload uncordon</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workspace-li><a href=/docs/cli-reference/kcp_workspace/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workspace><span>kcp workspace</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workspace_create-li><a href=/docs/cli-reference/kcp_workspace_create/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workspace_create><span>kcp workspace create</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workspace_create-context-li><a href=/docs/cli-reference/kcp_workspace_create-context/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workspace_create-context><span>kcp workspace create-context</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workspace_current-li><a href=/docs/cli-reference/kcp_workspace_current/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workspace_current><span>kcp workspace current</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workspace_tree-li><a href=/docs/cli-reference/kcp_workspace_tree/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workspace_tree><span>kcp workspace tree</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscli-referencekcp_workspace_use-li><a href=/docs/cli-reference/kcp_workspace_use/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscli-referencekcp_workspace_use><span>kcp workspace use</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscrd-reference-li><a href=/docs/crd-reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscrd-reference><span>CRD Reference</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/kcp-dev/kcp-dev.github.io/tree/main/docs/content/en/docs/Concepts/locations-and-scheduling.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/kcp-dev/kcp-dev.github.io/edit/main/docs/content/en/docs/Concepts/locations-and-scheduling.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/kcp-dev/kcp-dev.github.io/new/main/docs/content/en/docs/Concepts/locations-and-scheduling.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/kcp-dev/kcp-dev.github.io/issues/new?title=Placement,%20Locations%20and%20Scheduling" class=td-page-meta--issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/kcp-dev/kcp/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#main-concepts>Main Concepts</a><ul><li><a href=#placement-and-resource-scheduling>Placement and resource scheduling</a></li><li><a href=#resource-syncing>Resource Syncing</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=http://kcp-dev.github.io/docs/>Documentation</a></li><li class=breadcrumb-item><a href=http://kcp-dev.github.io/docs/concepts/>kcp Concepts</a></li><li class="breadcrumb-item active" aria-current=page><a href=http://kcp-dev.github.io/docs/concepts/locations-and-scheduling/ aria-disabled=true class="btn-link disabled">Placement, Locations and Scheduling</a></li></ol></nav><div class=td-content><h1>Placement, Locations and Scheduling</h1><div class=lead>KCP implements <em>Compute as a Service</em> via a concept of Transparent Multi Cluster (TMC).</div><header class=article-meta></header><p>KCP implements <em>Compute as a Service</em> via a concept of Transparent Multi Cluster (TMC). TMC means that
Kubernetes clusters are attached to a kcp installation to execute workload objects from the users'
workspaces by syncing these workload objects down to those clusters and the objects&rsquo; status
back up. This gives the illusion of native compute in KCP.</p><p>We call it <em>Compute as a Service</em> because the registered <code>SyncTargets</code> live in workspaces that
are (normally) invisible to the users, and the teams operating compute can be different from
the compute consumers.</p><p>The APIs used for Compute as a Service are:</p><ol><li><code>scheduling.kcp.dev/v1alpha1</code> – we call the outcome of this <em>placement</em> of namespaces.</li><li><code>workload.kcp.dev/v1alpha1</code> – responsible for the syncer component of TMC.</li></ol><h2 id=main-concepts>Main Concepts</h2><ul><li><p><code>SyncTarget</code> in <code>workload.kcp.dev/v1alpha1</code> – representations of Kubernetes clusters that are attached to a kcp installation to
execute workload objects from the users&rsquo; workspaces. On a Kubernetes cluster, there is one syncer
process for each <code>SyncTarget</code> object.</p><p>Sync targets are invisible to users, and (medium term) at most identified via a UID.</p></li><li><p><code>Location</code> in <code>scheduling.kcp.dev/v1alpha1</code> – represents a collection of <code>SyncTarget</code> objects selected via instance labels, and
exposes labels (potentially different from the instance labels) to the users to describe, identify and select locations to be used
for placement of user namespaces onto sync targets.</p><p>Locations are visible to users, but owned by the compute service team, i.e. read-only to the users and only projected
into their workspaces for visibility. A placement decision references a location by name.</p><p><code>SyncTarget</code>s in a <code>Location</code> are transparent to the user. Workloads should be able to seamlessly move from one <code>SyncTarget</code> to another
within a <code>Location</code>, based on operational concerns of the compute service provider, like decommissioning a cluster, rebalancing
capacity, or due to an outage of a cluster.</p><p>It is compute service&rsquo;s responsibility to ensure that for workloads in a location, to the user it looks like ONE cluster.</p></li><li><p><code>Placement</code> in <code>scheduling.kcp.dev/v1alpha1</code> – represents a selection rule to choose ONE <code>Location</code> via location labels, and bind
the selected location to MULTIPLE namespaces in a user workspace. For Workspaces with multiple Namespaces, users can create multiple
Placements to assign specific Namespace(s) to specific Locations.</p><p><code>Placement</code> are visible and writable to users. A default <code>Placement</code> is automatically created when a workload <code>APIBinding</code> is
created on the user workspace, which randomly select a <code>Location</code> and bind to all namespaces in this workspace. The user can mutate
or delete the default <code>Placement</code>. The corresponding <code>APIBinding</code> will be annotated with <code>workload.kcp.dev/skip-default-object-creation</code>,
so that the default <code>Placement</code> will not be recreated upon deletion.</p></li><li><p><em>Compute Service Workspace</em> (previously <em>Negotiation Workspace</em>) – the workspace owned by the compute service team to hold
the <code>APIExport</code> (named <code>kubernetes</code> today) with the synced resources, and <code>SyncTarget</code> and <code>Location</code> objects.</p><p>The user binds to the <code>APIExport</code> called <code>kubernetes</code> using an <code>APIBinding</code>. From this moment on, the users&rsquo; workspaces
are subject to placement.</p></li></ul><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4><p>Binding to a compute service is a permanent decision. Unbinding (i.e. deleting of the APIBinding object) means deletion of the
workload objects.</p><p>It is planned to allow multiple location workspaces for the same compute service, even with different owners.</p></div><h3 id=placement-and-resource-scheduling>Placement and resource scheduling</h3><p>The placement state is one of</p><ul><li><code>Pending</code> – the placement controller waits for a valid <code>Location</code> to select</li><li><code>Bound</code> – at least one namespace is bound to the placement. When the user updates the spec of the <code>Placement</code>, the selected location of
the placement will be changed in <code>Bound</code> state.</li><li><code>Unbound</code> – a location is selected by the placement, but no namespace is bound to the placement. When the user updates the spec of the <code>Placement</code>, the
selected location of the placement will be changed in <code>Unbound</code> state.</li></ul><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>Sync targets from different locations can be bound at the same time, while each location can only have one sync target bound to the
namespace.</div><p>The user interface to influence the placement decisions is the <code>Placement</code> object. For example, use can create a placement to bind namespace with
label of &ldquo;app=foo&rdquo; to a location with label &ldquo;cloud=aws&rdquo; as below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>scheduling.kcp.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Placement</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>locationSelectors</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cloud</span>: <span style=color:#ae81ff>aws</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>locationWorkspace</span>: <span style=color:#ae81ff>root:default:location-ws</span>
</span></span></code></pre></div><p>A matched location will be selected for this <code>Placement</code> at first, which makes the <code>Placement</code> turns from <code>Pending</code> to <code>Unbound</code>. Then if there is at
least one matching Namespace, the Namespace will be annotated with <code>scheduling.kcp.dev/placement</code> and the placement turns from <code>Unbound</code> to <code>Bound</code>.
After this, a <code>SyncTarget</code> will be selected from the location picked by the placement. <code>state.workload.kcp.dev/&lt;cluster-id></code> label with value of <code>Sync</code> will be set if a valid <code>SyncTarget</code> is selected.</p><p>The user can create another placement targeted to a different location for this Namespace, e.g.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>scheduling.kcp.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Placement</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gce</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>locationSelectors</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cloud</span>: <span style=color:#ae81ff>gce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>foo</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>locationWorkspace</span>: <span style=color:#ae81ff>root:default:location-ws</span>
</span></span></code></pre></div><p>which will result in another <code>state.workload.kcp.dev/&lt;cluster-id></code> label added to the Namespace, and the Namespace will have two different
<code>state.workload.kcp.dev/&lt;cluster-id></code> label.</p><p>Placement is in the <code>Ready</code> status condition when</p><ol><li>selected location matches the <code>Placement</code> spec.</li><li>selected location exists in the location workspace.</li></ol><h4 id=sync-target-removing>Sync target removing</h4><p>A sync target will be removed when:</p><ol><li>corresponding <code>Placement</code> is deleted.</li><li>corresponding <code>Placement</code> is not in <code>Ready</code> condition.</li><li>corresponding <code>SyncTarget</code> is evicting/not Ready/deleted</li></ol><p>All above cases will make the <code>SyncTarget</code> represented in the label <code>state.workload.kcp.dev/&lt;cluster-id></code> invalid, which will cause
<code>finalizers.workload.kcp.dev/&lt;cluster-id></code> annotation with removing time in the format of RFC-3339 added on the Namespace.</p><h3 id=resource-syncing>Resource Syncing</h3><p>As soon as the <code>state.workload.kcp.dev/&lt;cluster-id></code> label is set on the Namespace, the workload resource controller will
copy the <code>state.workload.kcp.dev/&lt;cluster-id></code> label to the resources in that namespace.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>In the future, the label on the resources is first set to empty string <code>""</code>, and a coordination controller will be
able to apply changes before syncing starts. This includes the ability to add per-location finalizers through the
<code>finalizers.workload.kcp.dev/&lt;cluster-id></code> annotation such that the coordination controller gets full control over
the downstream life-cycle of the objects per location (imagine an ingress that blocks downstream removal until the new replicas
have been launched on another sync target). Finally, the coordination controller will replace the empty string with <code>Sync</code>
such that the state machine continues.</div><p>With the state label set to <code>Sync</code>, the syncer will start seeing the resources in the namespace
and starts syncing them downstream, first by creating the namespace. Before syncing, it will also set
a finalizer <code>workload.kcp.dev/syncer-&lt;cluster-id></code> on the upstream object in order to delay upstream deletion until
the downstream object is also deleted.</p><p>When the <code>deletion.internal.workload.kcp.dev/&lt;cluster-id></code> is added to the Namespace. The virtual workspace apiserver
will translate that annotation into a deletion timestamp on the object the syncer sees. The syncer
notices that as a started deletion flow. As soon as there are no coordination controller finalizers registered via the
<code>finalizers.workload.kcp.dev/&lt;cluster-id></code> annotation anymore, the syncer will start a deletion of the downstream object.</p><p>When the downstream deletion is complete, the syncer will remove the finalizer from the upstream object, and the
<code>state.workload.kcp.dev/&lt;cluster-id></code> labels gets deleted as well. The syncer stops seeing the object in the virtual
workspace.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>There is a missing bit in the implementation (in v0.5) about removal of the <code>state.workload.kcp.dev/&lt;cluster-id></code>
label from namespaces: the syncer currently does not participate in the namespace deletion state-machine, but has to and signal finished
downstream namespace deletion via <code>state.workload.kcp.dev/&lt;cluster-id></code> label removal.</div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/kcp-users aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/kcp aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/kcp-dev/kcp aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://kubernetes.slack.com/archives/C021U8WSAFK aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/kcp-dev aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The kcp Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.ba3bfc0811f5d495647f814aadc74b292c03300cc581e5cdb379e6ad54046b52.js integrity="sha256-ujv8CBH11JVkf4FKrcdLKSwDMAzFgeXNs3nmrVQEa1I=" crossorigin=anonymous></script></body></html>